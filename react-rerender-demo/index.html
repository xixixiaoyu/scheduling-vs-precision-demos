<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>React 组件重新渲染演示</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu',
          'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        background-color: #f5f5f5;
        margin: 0;
        padding: 20px;
      }

      .container {
        max-width: 800px;
        margin: 0 auto;
        background-color: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      h1 {
        color: #333;
        text-align: center;
        margin-bottom: 30px;
      }

      .counter-section {
        text-align: center;
        margin-bottom: 30px;
      }

      .count-display {
        font-size: 24px;
        font-weight: bold;
        margin-bottom: 15px;
        color: #2c3e50;
      }

      button {
        background-color: #3498db;
        color: white;
        border: none;
        padding: 10px 20px;
        font-size: 16px;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.2s;
      }

      button:hover {
        background-color: #2980b9;
      }

      .children-container {
        display: flex;
        justify-content: space-between;
        margin-top: 30px;
      }

      .child {
        width: 30%;
        padding: 20px;
        border-radius: 8px;
        text-align: center;
        color: white;
        font-weight: bold;
        transition: background-color 0.3s ease;
      }

      .child h3 {
        margin-top: 0;
        margin-bottom: 10px;
      }

      .child p {
        margin: 0;
        font-size: 14px;
      }

      .info-section {
        margin-top: 30px;
        padding: 15px;
        background-color: #f8f9fa;
        border-radius: 4px;
        border-left: 4px solid #e74c3c;
      }

      .info-section h3 {
        margin-top: 0;
        color: #e74c3c;
      }

      .info-section p {
        margin-bottom: 0;
        color: #666;
      }

      .instructions {
        margin-top: 20px;
        padding: 15px;
        background-color: #e8f4fd;
        border-radius: 4px;
        border-left: 4px solid #3498db;
      }

      .instructions h3 {
        margin-top: 0;
        color: #3498db;
      }

      .instructions p {
        margin-bottom: 10px;
        color: #666;
      }

      .instructions ul {
        margin-top: 0;
        margin-bottom: 0;
        padding-left: 20px;
      }

      .instructions li {
        margin-bottom: 5px;
        color: #666;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      const { useState } = React

      // 生成随机颜色的函数
      const getRandomColor = () => {
        const colors = [
          '#e74c3c',
          '#3498db',
          '#2ecc71',
          '#f39c12',
          '#9b59b6',
          '#1abc9c',
          '#34495e',
          '#e67e22',
          '#95a5a6',
          '#d35400',
          '#c0392b',
          '#16a085',
          '#27ae60',
          '#2980b9',
          '#8e44ad',
        ]
        return colors[Math.floor(Math.random() * colors.length)]
      }

      // 子组件 A - 接收 count prop
      function ChildA({ count }) {
        // 每次渲染时生成随机背景色
        // 直接调用函数而不是使用 useState，确保每次渲染都生成新颜色
        const backgroundColor = getRandomColor()

        // 每次渲染时打印日志
        console.log('Child A is rendering!')

        return (
          <div className="child" style={{ backgroundColor }}>
            <h3>子组件 A</h3>
            <p>接收 count: {count}</p>
            <p>背景色: {backgroundColor}</p>
          </div>
        )
      }

      // 子组件 B - 不接收任何 props
      function ChildB() {
        // 每次渲染时生成随机背景色
        // 直接调用函数而不是使用 useState，确保每次渲染都生成新颜色
        const backgroundColor = getRandomColor()

        // 每次渲染时打印日志
        console.log('Child B is rendering!')

        return (
          <div className="child" style={{ backgroundColor }}>
            <h3>子组件 B</h3>
            <p>不接收任何 props</p>
            <p>背景色: {backgroundColor}</p>
          </div>
        )
      }

      // 子组件 C - 不接收任何 props
      function ChildC() {
        // 每次渲染时生成随机背景色
        // 直接调用函数而不是使用 useState，确保每次渲染都生成新颜色
        const backgroundColor = getRandomColor()

        // 每次渲染时打印日志
        console.log('Child C is rendering!')

        return (
          <div className="child" style={{ backgroundColor }}>
            <h3>子组件 C</h3>
            <p>不接收任何 props</p>
            <p>背景色: {backgroundColor}</p>
          </div>
        )
      }

      // 父组件
      function App() {
        const [count, setCount] = useState(0)

        // 每次渲染时打印日志
        console.log('App component is rendering!')

        const incrementCount = () => {
          setCount((prevCount) => prevCount + 1)
        }

        return (
          <div className="container">
            <h1>React 组件重新渲染演示</h1>

            <div className="counter-section">
              <div className="count-display">计数: {count}</div>
              <button onClick={incrementCount}>增加计数</button>
            </div>

            <div className="children-container">
              <ChildA count={count} />
              <ChildB />
              <ChildC />
            </div>

            <div className="info-section">
              <h3>关键观察点</h3>
              <p>
                当您点击"增加计数"按钮时，父组件的 count 状态会改变。 注意观察：
                <strong>即使 ChildB 和 ChildC 不依赖 count 状态， 它们也会被重新渲染</strong>
                （背景色会改变，控制台会打印日志）。
              </p>
              <p>
                这是 React 的默认行为：父组件重新渲染时，所有子组件都会重新渲染， 即使子组件的 props
                没有变化。这可能导致不必要的性能开销。
              </p>
            </div>

            <div className="instructions">
              <h3>演示步骤</h3>
              <p>请按照以下步骤观察 React 的重新渲染行为：</p>
              <ul>
                <li>打开浏览器的开发者工具，切换到控制台</li>
                <li>点击"增加计数"按钮</li>
                <li>观察控制台输出的日志（所有组件都会打印渲染日志）</li>
                <li>观察所有子组件的背景色都会改变</li>
                <li>即使 ChildB 和 ChildC 不接收任何 props，它们也会重新渲染</li>
              </ul>
            </div>
          </div>
        )
      }

      // 渲染应用
      const root = ReactDOM.createRoot(document.getElementById('root'))
      root.render(<App />)
    </script>
  </body>
</html>
