<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>React 组件优化渲染演示</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu',
          'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        background-color: #f5f5f5;
        margin: 0;
        padding: 20px;
      }

      .container {
        max-width: 800px;
        margin: 0 auto;
        background-color: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      h1 {
        color: #333;
        text-align: center;
        margin-bottom: 30px;
      }

      .counter-section {
        text-align: center;
        margin-bottom: 30px;
      }

      .count-display {
        font-size: 24px;
        font-weight: bold;
        margin-bottom: 15px;
        color: #2c3e50;
      }

      button {
        background-color: #3498db;
        color: white;
        border: none;
        padding: 10px 20px;
        font-size: 16px;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.2s;
      }

      button:hover {
        background-color: #2980b9;
      }

      .children-container {
        display: flex;
        justify-content: space-between;
        margin-top: 30px;
      }

      .child {
        width: 30%;
        padding: 20px;
        border-radius: 8px;
        text-align: center;
        color: white;
        font-weight: bold;
        transition: background-color 0.3s ease;
      }

      .child h3 {
        margin-top: 0;
        margin-bottom: 10px;
      }

      .child p {
        margin: 0;
        font-size: 14px;
      }

      .info-section {
        margin-top: 30px;
        padding: 15px;
        background-color: #e8f5e9;
        border-radius: 4px;
        border-left: 4px solid #4caf50;
      }

      .info-section h3 {
        margin-top: 0;
        color: #2e7d32;
      }

      .info-section p {
        margin-bottom: 0;
        color: #666;
      }

      .comparison {
        margin-top: 20px;
        padding: 15px;
        background-color: #e3f2fd;
        border-radius: 4px;
        border-left: 4px solid #2196f3;
      }

      .comparison h3 {
        margin-top: 0;
        color: #1565c0;
      }

      .comparison p {
        margin-bottom: 0;
        color: #666;
      }

      .instructions {
        margin-top: 20px;
        padding: 15px;
        background-color: #e8f4fd;
        border-radius: 4px;
        border-left: 4px solid #3498db;
      }

      .instructions h3 {
        margin-top: 0;
        color: #3498db;
      }

      .instructions p {
        margin-bottom: 10px;
        color: #666;
      }

      .instructions ul {
        margin-top: 0;
        margin-bottom: 0;
        padding-left: 20px;
      }

      .instructions li {
        margin-bottom: 5px;
        color: #666;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      const { useState, memo } = React

      // 生成随机颜色的函数
      const getRandomColor = () => {
        const colors = [
          '#e74c3c',
          '#3498db',
          '#2ecc71',
          '#f39c12',
          '#9b59b6',
          '#1abc9c',
          '#34495e',
          '#e67e22',
          '#95a5a6',
          '#d35400',
          '#c0392b',
          '#16a085',
          '#27ae60',
          '#2980b9',
          '#8e44ad',
        ]
        return colors[Math.floor(Math.random() * colors.length)]
      }

      // 子组件 A - 接收 count prop
      function ChildA({ count }) {
        // 每次渲染时生成随机背景色
        const backgroundColor = getRandomColor()

        // 每次渲染时打印日志
        console.log('Child A is rendering!')

        return (
          <div className="child" style={{ backgroundColor }}>
            <h3>子组件 A</h3>
            <p>接收 count: {count}</p>
            <p>背景色: {backgroundColor}</p>
          </div>
        )
      }

      // 子组件 B - 不接收任何 props，使用 memo 优化
      const ChildB = memo(function ChildB() {
        // 每次渲染时生成随机背景色
        const backgroundColor = getRandomColor()

        // 每次渲染时打印日志
        console.log('Child B is rendering!')

        return (
          <div className="child" style={{ backgroundColor }}>
            <h3>子组件 B</h3>
            <p>不接收任何 props (已优化)</p>
            <p>背景色: {backgroundColor}</p>
          </div>
        )
      })

      // 子组件 C - 不接收任何 props，使用 memo 优化
      const ChildC = memo(function ChildC() {
        // 每次渲染时生成随机背景色
        const backgroundColor = getRandomColor()

        // 每次渲染时打印日志
        console.log('Child C is rendering!')

        return (
          <div className="child" style={{ backgroundColor }}>
            <h3>子组件 C</h3>
            <p>不接收任何 props (已优化)</p>
            <p>背景色: {backgroundColor}</p>
          </div>
        )
      })

      // 父组件
      function App() {
        const [count, setCount] = useState(0)

        // 每次渲染时打印日志
        console.log('App component is rendering!')

        const incrementCount = () => {
          setCount((prevCount) => prevCount + 1)
        }

        return (
          <div className="container">
            <h1>React 组件优化渲染演示</h1>

            <div className="counter-section">
              <div className="count-display">计数: {count}</div>
              <button onClick={incrementCount}>增加计数</button>
            </div>

            <div className="children-container">
              <ChildA count={count} />
              <ChildB />
              <ChildC />
            </div>

            <div className="info-section">
              <h3>优化效果说明</h3>
              <p>
                这个演示展示了使用 <code>React.memo</code> 如何优化组件渲染。
                当您点击"增加计数"按钮时，只有 <strong>ChildA 会重新渲染</strong>， 而{' '}
                <strong>ChildB 和 ChildC 不会重新渲染</strong>（背景色保持不变，控制台无日志）。
              </p>
              <p>
                <code>React.memo</code> 会对组件进行浅比较，如果 props 没有变化，
                则跳过组件的重新渲染，提高性能。
              </p>
            </div>

            <div className="comparison">
              <h3>与未优化版本对比</h3>
              <p>
                在未优化版本中，所有子组件都会重新渲染。
                而在这个优化版本中，只有真正需要更新的组件才会重新渲染， 类似于 Vue 3
                的精确更新机制。
              </p>
              <p>这表明 React 也提供了优化工具，但需要开发者手动使用。</p>
            </div>

            <div className="instructions">
              <h3>演示步骤</h3>
              <p>请按照以下步骤观察 React 的优化渲染行为：</p>
              <ul>
                <li>打开浏览器的开发者工具，切换到控制台</li>
                <li>点击"增加计数"按钮</li>
                <li>观察控制台只输出 ChildA 的渲染日志</li>
                <li>观察只有 ChildA 的背景色会改变</li>
                <li>ChildB 和 ChildC 保持不变，展示了 React.memo 的优化效果</li>
              </ul>
            </div>
          </div>
        )
      }

      // 渲染应用
      const root = ReactDOM.createRoot(document.getElementById('root'))
      root.render(<App />)
    </script>
  </body>
</html>
